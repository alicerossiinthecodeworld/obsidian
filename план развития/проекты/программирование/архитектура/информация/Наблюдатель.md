#практикум #яндекс #работа #программирование  #шаблоныпроектирования

«Наблюдатель», или Observer, — поведенческий паттерн проектирования, который помогает следить объектам друг за другом и реагировать на происходящие внутри события. Для этого они используют механизм подписки.

Представьте, что ждёте выхода новой книги по JS — каждый день после работы посещаете книжный в надежде увидеть её на полке. Это не самый прагматичный подход. Проще попросить работника магазина оповестить вас о поступлении по телефону или почте. Подобный подход и описывает паттерн Observer. Он лежит в основе популярной среди React-разработчиков библиотеки Redux. Компоненты «не ходят» в хранилище, они просто подписываются на изменения в хранилище данных и получают его содержимое сразу после обновлений.

Реализуем простой механизм управления состоянием. В разных частях приложения следует реагировать на изменения состояния:

```
class State<T> {
  private listeners: Array<(data: T) => void> = []

  constructor(private data: T) {}

  subscribe(listener: (data: T) => void) {
    this.listeners.push(listener)
    listener(this.data)
  }

  updateData(data: T) {
    this.data = data
    this.listeners.forEach(fn => fn(data))
  }
} 
```

Рассмотрим подробнее класс `State`. Он содержит массив наблюдателей — функции обработчики, которые будут передаваться классу во время подписки на изменения данных.

В конструкторе передаём изначальные данные класса:


```
  constructor(private data: T) {} 
```

Метод `subscribe` принимает колбек для реакции на изменения состояния класса:

```
subscribe(listener: (data: T) => void) {
  this.listeners.push(listener)
  listener(this.data)
} 
```

А метод `updateData` обновляет данные `State` класса и вызывает всех слушателей с обновлёнными данными:

```
updateData(data: T) {
  this.data = data
  this.listeners.forEach(fn => fn(data))
} 
```

Теперь создадим экземпляр класса `State` и посмотрим, как механизм подписки выглядит в действии:

```
const state = new State({ name: 'Alex', age: 20 })

state.subscribe((data) => {
  console.log('New data', data)
})

console.log('Промежуточный код')

state.updateData({ name: 'Alex', age: 21 }) 
```

Результатом выполнения будет:
```
New data { name: 'Alex', age: 20 }

Промежуточный код

New data { name: 'Alex', age: 21 } 
```