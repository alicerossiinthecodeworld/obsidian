| declare  <br>    @btUser BIDENT = 141918, -- id пользователя из btUser<br>    @ps BIDENT = 172873, -- склад<br>    @login string = 'anproskuryakova', -- имя для терминала<br>    @computerName string = 'nb-msk-a0397', -- имя компьютера<br>    @dateId BIDENT,<br>    @storagePlaceId BIDENT<br><br><br>insert into Terminal (Name, MacAddress, SerialNumber, InventoryNumber, BTUserID, Comment, PhysicalStoreID)<br>values (@login, @computerName, null, null, null, null, @ps)<br><br>insert into BTUserStoreTaskType (BTUserID, StoreTaskTypeID)<br>values (@btUser, 1),<br>       (@btUser, 2),<br>       (@btUser, 3),<br>       (@btUser, 4),<br>       (@btUser, 9),<br>       (@btUser, 13),<br>       (@btUser, 20)<br><br>insert into BTUserRole (BTUserID, RoleID)<br>values (@btUser, 1130),<br>       (@btUser, 530),<br>       (@btUser, 577),<br>       (@btUser, 1115),<br>       (@btUser, 424),<br>       (@btUser, 399)<br><br><br>insert into StoreHost (HostName, PhysicalStoreID)<br>values (@computerName, @ps) -- для упаковки<br><br>if not exists(<br>        select 1<br>        from TerminalConfigurationBarcode<br>        where PhysicalStoreID = @ps<br>    )<br>    insert into TerminalConfigurationBarcode values (@ps, 'OPEN', null, null)<br>else<br>    update TerminalConfigurationBarcode set TerminalStart='OPEN' where PhysicalStoreID = @ps;<br><br>update BTUser<br>set LastName                 = replace(LastName, '0dis-', '')<br>  , LockedAt                 = null<br>  , LockedBy                 = null<br>  , ProcessingPhysicalStoreID=@ps<br>  , PhysicalStoreID=@ps<br>where ID = @btUser<br><br>select top 1 @storagePlaceId = ID<br>from StoragePlace<br>where PhysicalStoreID = @ps<br>  and Name like '%ЗПХ%'<br>order by id<br><br>insert into HostStoragePlace (HostName, StoragePlaceID, IncomeStoreTaskLimit, ProcessingType) -- для приемки<br>values (@computerName, @storagePlaceId, 6, 1)<br><br>select top 1 @dateId = ID<br>from DateShiftTimeTable<br>where Date = CONVERT(date, GETDATE())<br>order by id desc<br>if @dateId is null<br>    begin<br>        insert into dbo.DateShiftTimeTable (Date, ShiftID, TimeTableID)<br>        values (CONVERT(date, GETDATE()), 1, 1)<br>        select top 1 @dateId = ID from DateShiftTimeTable where Date = CONVERT(date, GETDATE()) order by id desc<br><br>        insert into dbo.DateShiftTimeTableBTUser<br>            (DateShiftTimeTableID, BTUserID, Moment)<br>        values (@dateId, @btUser, null)<br>    end;<br>else<br>    insert dbo.DateShiftTimeTableBTUser<br>        (DateShiftTimeTableID, BTUserID, Moment)<br>    values (@dateId, @btUser, null) |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
#запросы #еженедельные #работа 